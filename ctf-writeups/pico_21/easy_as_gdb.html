<div class="page-header">
    <div class="page-header-inner">
        <div class="page-header-inner2">
            <h1>Easy as GDB</h1>
            <h2>April 2021</h2>
            <h4>Flag Bruteforce</h4>
        </div>
    </div>
</div>
<H4>Problem</H4>
<div class="paragraph">
    <p>
        The flag has got to be checked somewhere... File: <a href=../../docs/pico/brute>brute</a>
        <br>
    </p>
</div>
<H4>Solution</H4>
<div class="paragraph">
    <p>
        I am going to use a combination of binary ninja, gdb and pwntools to solve this challenge.
        <br>
        Looking at the function in binary ninja we see that main calls 3 separate functions that transform our input before it is finally compared against the password in the third functions. Luckily for us the characters are checked 1 by 1, so we do not have to spend time reversing the encryption algorithms of all 3 functions. 
        <br><br>
    </p>
</div>
<div>
    <img src="../imgs/pico/easy_as_gdb_1.png" alt="">
</div>
<div class="paragraph">
    <p>
        <br>
        Below you can find my final script that I used to bruteforce the correct input, which as it turns out is also the flag. This script checks every character 1 by 1 until the final flag is eventually printed out. Overall this script took about 3 minutes to produce the flag. 
        <br><br>
    </p>
</div>
<div class="highlight" style="background: #002b36"><pre style="line-height: 125%;"><span></span><span style="color: #586e75; font-style: italic">#!/usr/bin/env python</span>
<span style="color: #cb4b16">from</span> <span style="color: #268bd2">pwn</span> <span style="color: #cb4b16">import</span> <span style="color: #586e75">*</span>

<span style="color: #839496">flag</span> <span style="color: #586e75">=</span> <span style="color: #2aa198">""</span>
<span style="color: #839496">p</span> <span style="color: #586e75">=</span> <span style="color: #839496">process([</span><span style="color: #2aa198">"gdb"</span><span style="color: #839496">,</span><span style="color: #2aa198">"./brute"</span><span style="color: #839496">])</span>
<span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">)</span>
<span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(</span><span style="color: #2aa198">"break *0x5655598e"</span><span style="color: #839496">)</span>     <span style="color: #586e75; font-style: italic">#breakpoint on character comparison</span>
<span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">)</span>
<span style="color: #839496">alphabet</span> <span style="color: #586e75">=</span> <span style="color: #839496">string</span><span style="color: #586e75">.</span><span style="color: #839496">ascii_letters</span> <span style="color: #586e75">+</span> <span style="color: #839496">string</span><span style="color: #586e75">.</span><span style="color: #839496">digits</span> <span style="color: #586e75">+</span> <span style="color: #2aa198">"{}_"</span>

<span style="color: #859900">while</span><span style="color: #839496">(</span><span style="color: #2aa198">1</span><span style="color: #839496">):</span>
    <span style="color: #859900">for</span> <span style="color: #839496">c</span> <span style="color: #859900">in</span> <span style="color: #839496">alphabet:</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(</span><span style="color: #2aa198">"run"</span><span style="color: #839496">)</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(flag</span> <span style="color: #586e75">+</span> <span style="color: #839496">c)</span>
        <span style="color: #859900">for</span> <span style="color: #839496">x</span> <span style="color: #859900">in</span> <span style="color: #268bd2">range</span><span style="color: #839496">(</span><span style="color: #268bd2">len</span><span style="color: #839496">(flag)):</span>
            <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">)</span>
            <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(</span><span style="color: #2aa198">"continue"</span><span style="color: #839496">)</span>
        <span style="color: #859900">if</span> <span style="color: #268bd2">len</span><span style="color: #839496">(flag)</span> <span style="color: #586e75">==</span> <span style="color: #2aa198">0</span><span style="color: #839496">:</span>
            <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">)</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(</span><span style="color: #2aa198">"p $eax"</span><span style="color: #839496">)</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">" = "</span><span style="color: #839496">)</span>
        <span style="color: #839496">str1</span> <span style="color: #586e75">=</span> <span style="color: #839496">((p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">))</span><span style="color: #586e75">.</span><span style="color: #839496">strip())[:</span><span style="color: #586e75">-</span><span style="color: #2aa198">6</span><span style="color: #839496">]</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">sendline(</span><span style="color: #2aa198">"p $edx"</span><span style="color: #839496">)</span>
        <span style="color: #839496">p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">" = "</span><span style="color: #839496">)</span>
        <span style="color: #839496">str2</span> <span style="color: #586e75">=</span> <span style="color: #839496">((p</span><span style="color: #586e75">.</span><span style="color: #839496">recvuntil(</span><span style="color: #2aa198">"(gdb) "</span><span style="color: #839496">))</span><span style="color: #586e75">.</span><span style="color: #839496">strip())[:</span><span style="color: #586e75">-</span><span style="color: #2aa198">6</span><span style="color: #839496">]</span>
        <span style="color: #859900">if</span> <span style="color: #839496">str1</span> <span style="color: #586e75">==</span> <span style="color: #839496">str2:</span> 
            <span style="color: #839496">flag</span> <span style="color: #586e75">+=</span><span style="color: #839496">c</span>
            <span style="color: #268bd2">print</span><span style="color: #839496">(flag)</span>
            <span style="color: #859900">break</span>
</pre></div>
<div>
    <img src="../imgs/pico/easy_as_gdb_2.png" alt="">
</div>
<br><br><br>
<script>try {pageOpenedDirectly;} catch(e) {var loc = window.location.pathname;var dir = loc.substring(0, loc.lastIndexOf('/'));dir = dir.split("/")[dir.split("/").length-1];let currentLoc = location.href;let currentFile = location.href.split("/").slice(-1);currentLoc = currentLoc.replace(currentFile,"");currentLoc = currentLoc.replace(dir,"");currentLoc = currentLoc.slice(0, -1);if (currentFile[0].indexOf(".html") !== -1) currentFile = currentFile[0].slice(0, -5);window.location = currentLoc+"?p="+currentFile+"&d="+dir;}</script>